!function(){"use strict";function k(){a.add("dimage",function(a){setTimeout(function(){a.dom.addStyle("p img {max-width:100%}")}),h.register(a),j.register(a)})}var a=tinymce.util.Tools.resolve("tinymce.PluginManager"),b=function(a){return a.getParam("dimageChoose",{},"object")},c=function(a){return a.getParam("dimageOptions",{},"object")},d=function(a){return a.getParam("dimageUploader",null,"function")},e={dimageChoose:b,dimageOptions:c,dimageUploader:d},f=function(a){var b=e.dimageChoose(a),c=e.dimageOptions(a),d=e.dimageUploader(a);return d&&""==(b.uploadUrl||"")?a.notificationManager.open({text:"UploadUrl is undefined",type:"error",closeButton:!1,timeout:3e3}):($.admin.layer.image(b,c,function(c,e){var f,g,h=function(h){f=h;var i=function(b){$.admin.layer.close(c),b instanceof Blob||b instanceof String?a.insertContent('<img src="'+("object"==typeof b?URL.createObjectURL(b):b)+'">'):"object"==typeof b&&$.each(b,function(b,c){a.insertContent('<img src="'+c+'">')})};g=d?d(b.uploadUrl,f,e,i):f,g&&($.admin.layer.close(c),a.insertContent('<img src="'+("object"==typeof g?URL.createObjectURL(g):g)+'">'))};b.cropper?b.base64?h(e.cropper.getCroppedCanvas().toDataURL(e.data.mime,b.cropper.quality||.9)):e.cropper.getCroppedCanvas().toBlob(h,e.data.mime,b.cropper.quality||.9):h(e.result)}),void 0)},g=function(a){a.addCommand("mceDimage",function(){f(a)})},h={register:g},i=function(a){a.ui.registry.addButton("dimage",{icon:"image",tooltip:"Insert/edit image",onAction:function(){return a.execCommand("mceDimage")}}),a.ui.registry.addMenuItem("dimage",{icon:"image",text:"Image...",onAction:function(){return a.execCommand("mceDimage")}})},j={register:i};k()}();
